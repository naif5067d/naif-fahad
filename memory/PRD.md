# HR Management System - PRD

## Original Problem Statement
ูุธุงู ุฅุฏุงุฑุฉ ููุงุฑุฏ ุจุดุฑูุฉ ุดุงูู ูุชุถูู:
- ุฅุฏุงุฑุฉ ุงูููุธููู ูุงูุนููุฏ
- ูุธุงู ุงูุญุถูุฑ ูุงูุงูุตุฑุงู ูุน GPS
- ุฅุฏุงุฑุฉ ุงูุฅุฌุงุฒุงุช ูุงูุฃุฐููุงุช
- ูุธุงู ุงููุนุงููุงุช ูุงูููุงููุงุช
- ููุญุฉ ุชุญูู ุฅุฏุงุฑูุฉ (STAS Mirror)

## Core Architecture
- **Backend**: FastAPI + MongoDB
- **Frontend**: React + Shadcn/UI + TailwindCSS
- **Database**: MongoDB (test_database)
  - ุงูุนููุฏ ูู ุฌุฏูู `contracts_v2`
  - ุงูููุธููู ูู ุฌุฏูู `employees`

## What's Been Implemented

### 2026-02-21 (Session 2)

1. **ุฅุตูุงุญ ุงูุชูููุช (P0)** โ
   - ุชุญููู ุฌููุน ุฃููุงุช ุงูุญุถูุฑ ูู UTC ุฅูู ุชูููุช ุงูุฑูุงุถ (+03:00)

2. **ุฅุตูุงุญ ูุดููุฉ "ูุง ููุฌุฏ ุนูุฏ ูุดุท" (P0)** โ
   - **ุงูุณุจุจ ุงูุฌุฐุฑู**: ูุงู ุงูููุฏ ูุจุญุซ ุจุดุฑุท `is_active: True`
   - ุงูุนููุฏ ูู `contracts_v2` ูุฏููุง `is_active: None`
   - **ุงููููุงุช ุงููุตูุญุฉ**:
     - `/app/backend/utils/attendance_rules.py`
     - `/app/backend/services/day_resolver_v2.py`

3. **ููุฒุฉ ุชุญุฏูุซ ุงูุฅุตุฏุงุฑ** โ
   - ุงุณุชุจุฏุงู "ุญุฐู ุงููุนุงููุงุช" ุจู "ุฅุฏุงุฑุฉ ุงูุฅุตุฏุงุฑ" ูู STAS Mirror

4. **ุฑุจุท ุงูููุธููู ุจูููุน ุงูุนูู** โ
   - ุฌููุน ุงูููุธููู ุงูุขู ูุฑุจูุทูู ุจุงูููุฑ ุงูุฑุฆูุณู

## System Flow (ูุตุฉ ุญูุงุฉ ุงูููุธู)

ุฑุงุฌุน ุงูููู: `/app/memory/SYSTEM_FLOW.md`

### ุชุฑุชูุจ ุงููุญุต ุงููููู (Day Resolver V2):
```
1. holiday    โ ุนุทูุฉ ุฑุณููุฉ
2. weekend    โ ุนุทูุฉ ููุงูุฉ ุฃุณุจูุน (ูู work_days ูู ูููุน ุงูุนูู)
3. leave      โ ุฅุฌุงุฒุฉ ูููุฐุฉ
4. mission    โ ูููุฉ ุฎุงุฑุฌูุฉ
5. forget     โ ูุณูุงู ุจุตูุฉ ูุนุชูุฏ
6. attendance โ ุจุตูุฉ ูุนููุฉ (ุชุญููู ุชุฃุฎูุฑ/ุฎุฑูุฌ ูุจูุฑ)
7. permission โ ุงุณุชุฆุฐุงู
8. excuses    โ ุชุจุฑูุฑุงุช
9. ABSENT     โ ุบูุงุจ
```

### ููู ููุญุฏุฏ ุงูุชุฃุฎูุฑ:
```python
work_start = "10:00"           # ูู ูููุน ุงูุนูู
grace_period = 10              # ูุชุฑุฉ ุงูุณูุงุญ (ุฏูุงุฆู)
allowed_late = "10:10"         # ุขุฎุฑ ููุช ูุณููุญ

if check_in > allowed_late:
    is_late = True
    late_minutes = check_in - work_start
```

### ููู ุชูุญุฏุฏ ุนุทูุฉ ููุงูุฉ ุงูุฃุณุจูุน:
- ูู ุญูู `work_days` ูู ูููุน ุงูุนูู
- ุฅุฐุง `friday: false` โ ุงูุฌูุนุฉ ุนุทูุฉ
- ูู ููุธู ุญุณุจ ูููุน ุนููู

## API Endpoints ุงููููุฉ

| Endpoint | ุงููุตู |
|----------|-------|
| `POST /api/attendance/check-in` | ุชุณุฌูู ุญุถูุฑ |
| `POST /api/attendance/check-out` | ุชุณุฌูู ุงูุตุฑุงู |
| `GET /api/attendance-engine/daily-status/{emp_id}/{date}` | ุชุญููู ููู + ุงูุนุฑูู |
| `POST /api/attendance-engine/process-daily` | ุงูุชุญุถูุฑ ุงููุฏูู |
| `GET /api/settings/version` | ุฅุตุฏุงุฑ ุงูุชุทุจูู |

## Test Credentials
- Admin: `stas` / `123456`
- Employee: `16` / `123456` (ูุญูุฏ ููุฒู)
- Employee: `10` / `123456` (ูููุฏ ุตุงุจุฑ)

## Prioritized Backlog

### P0 (Critical) - COMPLETED โ
- [x] ุฅุตูุงุญ ุงูุชูููุช
- [x] ุฅุตูุงุญ "ูุง ููุฌุฏ ุนูุฏ ูุดุท"
- [x] ุดุฑุญ ุขููุฉ ุงููุธุงู

### P1 (High)
- [ ] ุฏูุฌ ุตูุญุชู "ูุงููุชู" ู "ุงูุญุถูุฑ/ุงูุฌุฒุงุกุงุช"
- [ ] ูุงุฌูุฉ ุงูุชูููู ุงูุณููู ููุฃุฏุงุก

### P2 (Medium)
- [ ] ูุธุงู ุงููุฑูุถ
- [ ] ุฅุธูุงุฑ ุงูููุฒุงุช ุงููุฎููุฉ ูู ุงููุงุฌูุฉ
- [ ] ุชุญุณูู ุตูุงุญูุงุช ุงููุดุฑููู

### 2026-02-21 (Session 3) - UI/UX Theme Enforcement โ

**ุงููููุฉ ุงูุฑุฆูุณูุฉ:** ุชุทุจูู ุดุงูู ูุฃููุงู ุงูุดุฑูุฉ ูุฅุฒุงูุฉ ุฌููุน ุงูุฅูููุฌู ูุงูุฃููููุงุช ุบูุฑ ุงูููููุฉ

#### ุงูุชุบููุฑุงุช ุงูููุฌุฒุฉ:

1. **ุงุณุชุจุฏุงู ุฃููููุฉ HandMetal ุจู FileSignature** โ
   - ุงูุฃููููุฉ ุงูุณุงุจูุฉ ูุงูุช ุบูุฑ ููููุฉ
   - ุงููููุงุช ุงููุนุฏูุฉ: `TeamAttendancePage.js`

2. **ุฅุฒุงูุฉ ุฌููุน ุงูุฅูููุฌู ูู ุงููุงุฌูุงุช** โ
   - ุฅุฒุงูุฉ: ๐, โณ, โ, ๐, ๐, ๐, โ๏ธ, โ๏ธ, ๐ฅ
   - ุงุณุชุจุฏุงููุง ุจุฃููููุงุช Lucide-react ุงุญุชุฑุงููุฉ

3. **ุชุทุจูู ุฃููุงู ุงูุดุฑูุฉ** โ
   - ุชุตุญูุญ 342+ ุงูุชูุงู ููุฃููุงู
   - ุงูุฃููุงู ุงููุนุชูุฏุฉ:
     - Navy: `hsl(222, 47%, 24%)` - #1E3A5F
     - Lavender: `hsl(262, 83%, 76%)` - #A78BFA
     - Success: `hsl(160, 84%, 39%)`
     - Warning: `hsl(38, 92%, 50%)`
     - Info: `hsl(217, 91%, 60%)`
     - Destructive: `hsl(0, 84%, 60%)`

4. **ุงููููุงุช ุงููุนุฏูุฉ ุงูุฑุฆูุณูุฉ:**
   - `/app/frontend/src/pages/TeamAttendancePage.js`
   - `/app/frontend/src/pages/AdminCustodyPage.js`
   - `/app/frontend/src/pages/STASMirrorPage.js`
   - `/app/frontend/src/pages/LoginPage.js`
   - `/app/frontend/src/pages/DashboardPage.js`
   - `/app/frontend/src/pages/LeavePage.js`
   - `/app/frontend/src/pages/ContractsManagementPage.js`
   - `/app/frontend/src/components/NotificationBell.js`
   - `/app/frontend/src/components/Timeline.js`
   - `/app/frontend/src/components/ErrorAlert.js`
   - `/app/frontend/src/App.css`
   - ุฌููุน ุงูุตูุญุงุช ูุงูููููุงุช ุงูุฃุฎุฑู

5. **ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ:**
   - 8/8 ุงุฎุชุจุงุฑุงุช ุฃุณุงุณูุฉ ูุงุฌุญุฉ
   - ูุณุจุฉ ุงููุฌุงุญ: 100%

### 2026-02-22 - ูุธุงู ุชุชุจุน ุงููุชูุฏููู (ATS) โ

**ุงููููุฉ ุงูุฑุฆูุณูุฉ:** ุจูุงุก ูุธุงู ATS ูุงูู ููุณุชูู ุนู ุงููุธุงู ุงูุฑุฆูุณู

#### ุงูููุฒุงุช ุงูููุฌุฒุฉ:

1. **ุงูุนุฒู ุงูุฃููู ุงููุงูู** โ
   - ูุงุนุฏุฉ ุจูุงูุงุช ูููุตูุฉ ูุชุฎุฒูู ุงูุจูุงูุงุช
   - ูุฌูุฏ ุชุฎุฒูู ูุณุชูู ูููููุงุช: `/app/ats_storage/cv_files`
   - ูุง ููุฌุฏ ุฃู ุชุฏุงุฎู ูุน ุจูุงูุงุช ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ ุงูุฑุฆูุณูุฉ

2. **ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ (Admin)** โ
   - ุฅูุดุงุก ุงููุธุงุฆู ูุชุนุฏูููุง ูุฅุบูุงููุง
   - ุนุฑุถ ุงูุทูุจุงุช ูุน ุงูุชุตููู ุงูุฐูู (Tier A/B/C)
   - ูุธุงู ุงูููุงุญุธุงุช ูุงูุชูููู
   - ุฅุญุตุงุฆูุงุช ุดุงููุฉ

3. **ุงูุจูุงุจุฉ ุงูุนุงูุฉ (Public)** โ
   - ุตูุญุฉ `/careers` ูุนุฑุถ ุฌููุน ุงููุธุงุฆู ุงููุดุทุฉ
   - ูููุฐุฌ ุชูุฏูู ูุน ุฑูุน ูููุงุช (PDF/DOC/DOCX)
   - ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ

4. **ุงููุญุฑู ุงูุฐูู (Phase 2)** โ
   - ุงุณุชุฎุฑุงุฌ ุงููุต ูู ูููุงุช ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ
   - ุชูููู ุขูู (0-100) ูุน ุชุตููู (Excellent/Strong/Acceptable/Weak)
   - ูุดู ุงูุญุดู (Fluff) ูุงูุฃูุง (Ego)
   - ุนูุงูุฉ "High Potential" ููููุงูุจ ุงููุงุนุฏุฉ

5. **ุงูุญุฐู ุงููููู (Nuclear Delete)** โ - 2026-02-22
   - ูุชุงุญ ููุท ูู `stas` ู `sultan`
   - ุญุฐู ุฌููุน ุงูุทูุจุงุช ูุงููููุงุช ุจุดูู ููุงุฆู
   - ุญูุงุฑ ุชุฃููุฏ ูุน ูุชุงุจุฉ "DELETE ALL"
   - ุชุณุฌูู ุงูุนูููุงุช ูู audit log

#### ุงููููุงุช ุงูุฑุฆูุณูุฉ:
- **Backend:**
  - `/app/backend/routes/ats_admin.py` - API ุงูุฅุฏุงุฑุฉ
  - `/app/backend/routes/ats_public.py` - API ุงูุนุงูุฉ
  - `/app/backend/services/ats_scoring.py` - ูุญุฑู ุงูุชูููู
  - `/app/backend/services/ats_extraction.py` - ุงุณุชุฎุฑุงุฌ ุงููุตูุต

- **Frontend:**
  - `/app/frontend/src/pages/ATSPage.js` - ุตูุญุฉ ุงูุฅุฏุงุฑุฉ
  - `/app/frontend/src/pages/CareersPage.js` - ุงูุจูุงุจุฉ ุงูุนุงูุฉ
  - `/app/frontend/src/pages/PublicApplyPage.js` - ูููุฐุฌ ุงูุชูุฏูู

#### ุตูุงุญูุงุช ATS:
| ุงููุณุชุฎุฏู | ุงููุตูู | ุงูุญุฐู ุงููููู |
|----------|--------|--------------|
| stas | โ | โ |
| sultan | โ | โ |
| naif | โ | โ |
| mohammed | โ | โ |
| HR Role | โ | โ |

---

### 2026-02-22 (Session 4) - ูุธุงู ุงูุณุงุนุงุช ุงูุฐููุฉ (Smart Hours) โ

**ุงููููุฉ ุงูุฑุฆูุณูุฉ:** ุชูููุฐ ูุธุงู ุณูุงุญ ุงูุชุนููุถ ุงูุดูุฑู

#### ุงูููููู:
- **ุณุงุนุงุช ุงูุงุณุชุฆุฐุงู (2-3 ุณุงุนุงุช/ุดูุฑ):** ุญู ูุธุงูู ููููุธูุ ูุง ุชูุฎุตู ูู ุฑุงุชุจูุ ูุดุฑูุทุฉ ุจุงูููุงููุฉ
- **ุณูุงุญ ุงูุชุนููุถ (0-50 ุณุงุนุฉ/ุดูุฑ):** ุฅุนุฏุงุฏ ุฅุฏุงุฑู ุฎุงุตุ ุงูููุธู ูุง ูุฑุงูุ ูุณูุญ ุจุชุนููุถ ุงูุชุฃุฎูุฑุงุช ุจุงูุณุงุนุงุช ุงูุฅุถุงููุฉ

#### ุงูููุฒุงุช ุงูููุฌุฒุฉ:

1. **API ุณูุงุญ ุงูุชุนููุถ** โ
   - `GET /api/settings/compensation-allowance` - ุฌูุจ ุงูุฅุนุฏุงุฏ (ูููุฏุฑุงุก ููุท)
   - `PUT /api/settings/compensation-allowance` - ุชุญุฏูุซ ุงูุฅุนุฏุงุฏ

2. **ูุงุฌูุฉ ุงููุณุชุฎุฏู** โ
   - ูุณู ุฌุฏูุฏ ูู ุฃุนูู ุตูุญุฉ ููุงูุน ุงูุนูู
   - Slider ูุงุฎุชูุงุฑ ูููุฉ ุณูุงุญ ุงูุชุนููุถ (0-50 ุณุงุนุฉ)
   - ุฃุฒุฑุงุฑ ุณุฑูุนุฉ ููุงุฎุชูุงุฑ (0, 5, 10, 20, 30, 50)
   - ุงูููุธู ุงูุนุงุฏู ูุง ูุฑู ูุฐุง ุงููุณู

3. **ุญุณุงุจ ุงูุฎุตููุงุช ุงูุฐูู** โ
   - ุญุณุงุจ ุงูููุต ุงูุฅุฌูุงูู (ุชุฃุฎูุฑ + ุฎุฑูุฌ ูุจูุฑ)
   - ุญุณุงุจ ุงูุณุงุนุงุช ุงูุฅุถุงููุฉ (ุงูุจูุงุก ุจุนุฏ ุงูุฏูุงู)
   - ุงูุฎุตู ุงูุตุงูู = ุงูููุต - MIN(ุงูุณุงุนุงุช ุงูุฅุถุงููุฉ, ุณูุงุญ ุงูุชุนููุถ)
   - ุดุฑุญ ููุตู ููุญุณุงุจ ูู `calculation_note_ar`

#### ุงููููุงุช ุงููุนุฏูุฉ:
- `backend/routes/settings.py` - ุฅุถุงูุฉ API ุณูุงุญ ุงูุชุนููุถ
- `backend/services/penalty_service.py` - ููุทู ุงูุณุงุนุงุช ุงูุฐููุฉ
- `frontend/src/pages/WorkLocationsPage.js` - ูุงุฌูุฉ ุณูุงุญ ุงูุชุนููุถ

#### ุตูุงุญูุงุช ุณูุงุญ ุงูุชุนููุถ:
| ุงููุณุชุฎุฏู | ุฑุคูุฉ ุงูุฅุนุฏุงุฏ | ุชุนุฏูู ุงูุฅุนุฏุงุฏ |
|----------|-------------|---------------|
| stas | โ | โ |
| sultan | โ | โ |
| naif | โ | โ |
| salah | โ | โ |
| mohammed | โ | โ |
| employee | โ | โ |

---

## Prioritized Backlog (Updated)

### P0 (Critical) - COMPLETED โ
- [x] ุฅุตูุงุญ ุงูุชูููุช
- [x] ุฅุตูุงุญ "ูุง ููุฌุฏ ุนูุฏ ูุดุท"
- [x] ุดุฑุญ ุขููุฉ ุงููุธุงู
- [x] ูุธุงู ATS - ุงููุฑุญูุฉ ุงูุฃููู
- [x] ูุธุงู ATS - ุงููุฑุญูุฉ ุงูุซุงููุฉ (ุงูุฐูู)
- [x] ููุฒุฉ ุงูุญุฐู ุงููููู ููู ATS
- [x] ูุธุงู ุงูุณุงุนุงุช ุงูุฐููุฉ (Smart Hours)

### P1 (High)
- [ ] ุชุฃููุฏ ุฅุตูุงุญ iframe ููู ATS ูู ูููุน Wuilt
- [ ] ุฏูุฌ ุตูุญุชู "ูุงููุชู" ู "ุงูุญุถูุฑ/ุงูุฌุฒุงุกุงุช"
- [ ] ูุงุฌูุฉ ุงูุชูููู ุงูุณููู ููุฃุฏุงุก
- [ ] ุชูุฑูุฑ ุงููุนุงูุฑุฉ ุงูุดูุฑู ููู ATS

### P2 (Medium)
- [ ] ูุธุงู ุงููุฑูุถ
- [ ] ุฅุธูุงุฑ ุงูููุฒุงุช ุงููุฎููุฉ ูู ุงููุงุฌูุฉ
- [ ] ุชุญุณูู ุตูุงุญูุงุช ุงููุดุฑููู
- [ ] ููุฒุฉ ุงูุจุญุซ ุจุงูุจุงุฑููุฏ ูุงููุงููุฑุง

