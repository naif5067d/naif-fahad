# Ø¯Ù„ÙŠÙ„ ØµØ­Ø© Ø§Ù„ØªÙ†ÙÙŠØ° - Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª
## Evidence Report - Attendance & Deduction Engine

**ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…:** 2026-02-18
**Ø§Ù„Ø­Ø§Ù„Ø©:** âœ… Ù…ÙƒØªÙ…Ù„ ÙˆÙ…Ø®ØªØ¨Ø±

---

## 1. Ø§Ù„Ø¹Ø±ÙˆÙ‚ Ø§Ù„Ù…Ø¶Ø§ÙØ© (Trace Functions)

### Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: `/app/backend/services/day_resolver_v2.py`

```
DayResolverV2 - Ù…Ø­Ø±Ùƒ Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù…Ø¹ Ø§Ù„Ø¹Ø±ÙˆÙ‚ (Trace Evidence)

ØªØ±ØªÙŠØ¨ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ:
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ # â”‚ Ø§Ù„Ø®Ø·ÙˆØ© (Step)   â”‚ Ø§Ù„ÙˆØµÙ                    â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚ holiday         â”‚ Ø§Ù„Ø¹Ø·Ù„ Ø§Ù„Ø±Ø³Ù…ÙŠØ©            â”‚
â”‚ 2  â”‚ weekend         â”‚ Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹       â”‚
â”‚ 3  â”‚ leave           â”‚ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ù…Ù†ÙØ°Ø©         â”‚
â”‚ 4  â”‚ mission         â”‚ Ø§Ù„Ù…Ù‡Ù…Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©         â”‚
â”‚ 5  â”‚ forget_checkin  â”‚ Ù†Ø³ÙŠØ§Ù† Ø§Ù„Ø¨ØµÙ…Ø©             â”‚
â”‚ 6  â”‚ attendance      â”‚ Ø§Ù„Ø¨ØµÙ…Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©           â”‚
â”‚ 7  â”‚ permission      â”‚ Ø§Ù„Ø§Ø³ØªØ¦Ø°Ø§Ù† Ø§Ù„Ø¬Ø²Ø¦ÙŠ         â”‚
â”‚ 8  â”‚ excuses         â”‚ Ø§Ù„ØªØ¨Ø±ÙŠØ±Ø§Øª                â”‚
â”‚ 9  â”‚ ABSENT          â”‚ ØºÙŠØ§Ø¨ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)           â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ø£ÙˆÙ„ Ù†ØªÙŠØ¬Ø© ØµØ­ÙŠØ­Ø© = Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
```

### Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:

| Ø§Ù„Ø¯Ø§Ù„Ø© | Ø§Ù„Ù…Ù‡Ù…Ø© | Ø§Ù„Ù…ÙƒØ§Ù† |
|--------|--------|--------|
| `resolve_day_v2()` | ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ | `day_resolver_v2.py:L450` |
| `resolve_and_save_v2()` | ØªØ­Ù„ÙŠÙ„ + Ø­ÙØ¸ | `day_resolver_v2.py:L456` |
| `_check_holidays()` | ÙØ­Øµ Ø§Ù„Ø¹Ø·Ù„ | `day_resolver_v2.py:L145` |
| `_check_weekend()` | ÙØ­Øµ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ | `day_resolver_v2.py:L170` |
| `_check_leaves()` | ÙØ­Øµ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª | `day_resolver_v2.py:L205` |
| `_check_missions()` | ÙØ­Øµ Ø§Ù„Ù…Ù‡Ù…Ø§Øª | `day_resolver_v2.py:L255` |
| `_check_forgotten_punch()` | ÙØ­Øµ Ù†Ø³ÙŠØ§Ù† Ø§Ù„Ø¨ØµÙ…Ø© | `day_resolver_v2.py:L285` |
| `_check_attendance()` | ÙØ­Øµ Ø§Ù„Ø¨ØµÙ…Ø© | `day_resolver_v2.py:L315` |
| `_check_permissions()` | ÙØ­Øµ Ø§Ù„Ø§Ø³ØªØ¦Ø°Ø§Ù† | `day_resolver_v2.py:L400` |
| `_generate_trace_summary()` | Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ø±ÙˆÙ‚ | `day_resolver_v2.py:L100` |

---

## 2. ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©

### Flow: Ù…Ù† Ø§Ù„Ø¨ØµÙ…Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø®ØµÙ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± (Check-in/Check-out)                           â”‚
â”‚    â†“                                                            â”‚
â”‚    POST /api/attendance/check-in                               â”‚
â”‚    â†’ ÙŠÙØ­ÙØ¸ ÙÙŠ attendance_ledger                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ… (Daily Job)                                      â”‚
â”‚    â†“                                                            â”‚
â”‚    POST /api/attendance-engine/jobs/daily                      â”‚
â”‚    â†’ ÙŠØ´ØºÙ„ DayResolverV2 Ù„ÙƒÙ„ Ù…ÙˆØ¸Ù                               â”‚
â”‚    â†’ ÙŠÙØ­Øµ Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨: holidayâ†’weekendâ†’leaveâ†’missionâ†’...          â”‚
â”‚    â†’ ÙŠÙØ­ÙØ¸ ÙÙŠ daily_status Ù…Ø¹ trace_log ÙƒØ§Ù…Ù„                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‚ØªØ±Ø­ Ø§Ù„Ø®ØµÙ… (Auto-proposal)                           â”‚
â”‚    â†“                                                            â”‚
â”‚    Ø¥Ø°Ø§ final_status == ABSENT                                  â”‚
â”‚    â†’ create_absence_deduction_proposal()                       â”‚
â”‚    â†’ ÙŠÙØ­ÙØ¸ ÙÙŠ deduction_proposals Ø¨Ø­Ø§Ù„Ø© "pending"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­ (Sultan/Naif)                                â”‚
â”‚    â†“                                                            â”‚
â”‚    POST /api/attendance-engine/deductions/{id}/review          â”‚
â”‚    â†’ approved=true â†’ Ø§Ù„Ø­Ø§Ù„Ø© ØªØµØ¨Ø­ "approved"                    â”‚
â”‚    â†’ approved=false â†’ Ø§Ù„Ø­Ø§Ù„Ø© ØªØµØ¨Ø­ "rejected"                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ØªÙ†ÙÙŠØ° Ø§Ù„Ø®ØµÙ… (STAS ÙÙ‚Ø·)                                      â”‚
â”‚    â†“                                                            â”‚
â”‚    POST /api/attendance-engine/deductions/{id}/execute         â”‚
â”‚    â†’ execute_proposal()                                        â”‚
â”‚    â†’ ÙŠÙÙ†Ø´Ø¦ Ø³Ø¬Ù„ ÙÙŠ finance_ledger                               â”‚
â”‚    â†’ Ø§Ù„Ø­Ø§Ù„Ø© ØªØµØ¨Ø­ "executed"                                    â”‚
â”‚                                                                 â”‚
â”‚    âš ï¸ Ù„Ø§ Ø®ØµÙ… ÙŠÙØ³Ø¬Ù„ Ø¨Ø¯ÙˆÙ† STAS                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ÙƒÙŠÙ ÙŠØªØ£ÙƒØ¯ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ù† Ø¹Ø¯Ù… Ø¸Ù„Ù… Ø§Ù„Ù…ÙˆØ¸Ù

### Ø§Ù„ÙØ­ÙˆØµØ§Øª Ù‚Ø¨Ù„ ABSENT:

```python
# ÙÙŠ DayResolverV2.resolve():

# 1. Ù‡Ù„ Ø§Ù„ÙŠÙˆÙ… Ø¹Ø·Ù„Ø© Ø±Ø³Ù…ÙŠØ©ØŸ
result = await self._check_holidays()
if result: return result  # âœ… Ø¹Ø·Ù„Ø© - Ù„ÙŠØ³ ØºÙŠØ§Ø¨

# 2. Ù‡Ù„ Ø§Ù„ÙŠÙˆÙ… Ù†Ù‡Ø§ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹ØŸ
result = await self._check_weekend()
if result: return result  # âœ… Ø¹Ø·Ù„Ø© - Ù„ÙŠØ³ ØºÙŠØ§Ø¨

# 3. Ù‡Ù„ Ù„Ù„Ù…ÙˆØ¸Ù Ø¥Ø¬Ø§Ø²Ø© Ù…Ù†ÙØ°Ø© ØªØ´Ù…Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…ØŸ
result = await self._check_leaves()
if result: return result  # âœ… Ø¥Ø¬Ø§Ø²Ø© - Ù„ÙŠØ³ ØºÙŠØ§Ø¨

# 4. Ù‡Ù„ Ù„Ù„Ù…ÙˆØ¸Ù Ù…Ù‡Ù…Ø© Ø®Ø§Ø±Ø¬ÙŠØ© Ù…Ù†ÙØ°Ø©ØŸ
result = await self._check_missions()
if result: return result  # âœ… Ù…Ù‡Ù…Ø© - Ù„ÙŠØ³ ØºÙŠØ§Ø¨

# 5. Ù‡Ù„ Ù„Ù„Ù…ÙˆØ¸Ù Ø·Ù„Ø¨ Ù†Ø³ÙŠØ§Ù† Ø¨ØµÙ…Ø© Ù…Ù†ÙØ°ØŸ
result = await self._check_forgotten_punch()
if result: return result  # âœ… Ù†Ø³ÙŠØ§Ù† Ù…Ø¹ØªÙ…Ø¯ - Ù„ÙŠØ³ ØºÙŠØ§Ø¨

# 6. Ù‡Ù„ Ø³Ø¬Ù„ Ø¨ØµÙ…Ø© ÙØ¹Ù„ÙŠØ©ØŸ
result = await self._check_attendance()
if result: return result  # âœ… Ø­Ø§Ø¶Ø± (ÙƒØ§Ù…Ù„/Ù…ØªØ£Ø®Ø±/Ù…Ø¨ÙƒØ±)

# 7. Ù‡Ù„ Ù„Ø¯ÙŠÙ‡ Ø§Ø³ØªØ¦Ø°Ø§Ù† Ø¬Ø²Ø¦ÙŠ Ù…Ù†ÙØ°ØŸ
result = await self._check_permissions()
if result: return result  # âœ… Ø§Ø³ØªØ¦Ø°Ø§Ù† - Ù„ÙŠØ³ ØºÙŠØ§Ø¨

# 8. ÙÙ‚Ø· Ø¥Ø°Ø§ ÙØ´Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ­ÙˆØµØ§Øª:
return self._create_absent_result()  # âŒ ØºÙŠØ§Ø¨
```

### Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙØ¹Ù„ÙŠ:

```
Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª
============================================================

ğŸ“Œ Ø§Ø®ØªØ¨Ø§Ø± 1: Day Resolver V2
----------------------------------------
Ø§Ù„Ø­Ø§Ù„Ø©: ØºÙŠØ§Ø¨
Ø§Ù„Ø³Ø¨Ø¨: ØºÙŠØ§Ø¨ - Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø²Ø© Ø£Ùˆ Ù…Ù‡Ù…Ø© Ø£Ùˆ Ø¨ØµÙ…Ø© Ø£Ùˆ Ø¹Ø·Ù„Ø©
Ø§Ù„Ø®Ù„Ø§ØµØ©: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¹Ø·Ù„Ø© Ø£Ùˆ Ø¥Ø¬Ø§Ø²Ø© Ø£Ùˆ Ù…Ù‡Ù…Ø© Ø£Ùˆ Ø¨ØµÙ…Ø© - ÙŠÙØ¹ØªØ¨Ø± ØºØ§Ø¦Ø¨Ø§Ù‹
âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: True

ğŸ“Œ Ø§Ø®ØªØ¨Ø§Ø± 2: Ø§Ù„Ø¹Ø·Ù„Ø© ØªÙ…Ù†Ø¹ Ø§Ù„ØºÙŠØ§Ø¨
----------------------------------------
Ø§Ù„Ø­Ø§Ù„Ø©: Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹
âœ… Ù†Ø¬Ø­: Ø§Ù„Ø¹Ø·Ù„Ø© Ù…ÙØ¹ØªØ±Ù Ø¨Ù‡Ø§

ğŸ“Œ Ø§Ø®ØªØ¨Ø§Ø± 3: Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ù…Ù†ÙØ°Ø© ØªÙ…Ù†Ø¹ Ø§Ù„ØºÙŠØ§Ø¨
----------------------------------------
Ø§Ù„Ù…ÙˆØ¸Ù: 2c291a9b-277b-437a-920f-a76eb4cbaf71
Ø§Ù„ØªØ§Ø±ÙŠØ®: 2026-01-05
Ø§Ù„Ø­Ø§Ù„Ø©: Ø¥Ø¬Ø§Ø²Ø© Ø³Ù†ÙˆÙŠØ©
âœ… Ù†Ø¬Ø­: Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ù…Ù†ÙØ°Ø© ØªÙ…Ù†Ø¹ Ø§Ù„ØºÙŠØ§Ø¨

ğŸ“Œ Ø§Ø®ØªØ¨Ø§Ø± 4: Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ø±ÙˆÙ‚
----------------------------------------
Ø¹Ø¯Ø¯ Ø®Ø·ÙˆØ§Øª Ø§Ù„ÙØ­Øµ: 8
âœ… Ù†Ø¬Ø­: Ø§Ù„Ø¹Ø±ÙˆÙ‚ Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ…ÙƒØªÙ…Ù„Ø©

ğŸ“Œ Ø§Ø®ØªØ¨Ø§Ø± 5: ØªØ´ØºÙŠÙ„ Job Ø§Ù„ÙŠÙˆÙ…ÙŠ
----------------------------------------
Ø§Ù„ØªØ§Ø±ÙŠØ®: 2026-02-16
Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ÙŠÙ†: 7
Ù†Ø¬Ø­: 7
ÙØ´Ù„: 0
ØºÙŠØ§Ø¨: 4
âœ… Ù†Ø¬Ø­: Job Ø§Ù„ÙŠÙˆÙ…ÙŠ ÙŠØ¹Ù…Ù„

============================================================
âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­Øª!
============================================================
```

---

## 4. ÙƒÙŠÙ ØªÙØ³Ø¬Ù„ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª ÙÙŠ finance_ledger

### Ø¹Ù†Ø¯ ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‚ØªØ±Ø­ (STAS ÙÙ‚Ø·):

```python
# ÙÙŠ deduction_service.py:execute_proposal()

finance_entry = {
    "id": str(uuid.uuid4()),
    "employee_id": proposal['employee_id'],
    "type": "debit",  # Ø®ØµÙ…
    "code": "DEDUCTION",
    "amount": proposal['amount'],
    "currency": "SAR",
    "description": proposal['reason'],
    "description_ar": proposal['reason_ar'],
    "source": "deduction_proposal",
    "source_id": proposal_id,
    "deduction_type": proposal['deduction_type'],
    "month": proposal['month'],
    "explanation": proposal['explanation'],
    "executed_by": executor_id,  # STAS
    "executed_at": now,
    "created_at": now
}

await db.finance_ledger.insert_one(finance_entry)
```

### Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ (Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ):

```
Ø§Ù„Ø£Ø¬Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ = Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ã· 30
Ø§Ù„Ø£Ø¬Ø± Ø¨Ø§Ù„Ø³Ø§Ø¹Ø© = Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ã· 30 Ã· Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…

Ù…Ø«Ø§Ù„:
- Ø§Ù„Ø±Ø§ØªØ¨: 11,500 Ø±ÙŠØ§Ù„
- Ø§Ù„Ø£Ø¬Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ: 11,500 Ã· 30 = 383.33 Ø±ÙŠØ§Ù„
- Ø§Ù„Ø£Ø¬Ø± Ø¨Ø§Ù„Ø³Ø§Ø¹Ø©: 383.33 Ã· 8 = 47.92 Ø±ÙŠØ§Ù„
```

---

## 5. ÙƒÙŠÙ ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ Jobs Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©

### Job ÙŠÙˆÙ…ÙŠ:
```bash
POST /api/attendance-engine/jobs/daily
{"target_date": "2026-02-17"}
```

### Job Ø´Ù‡Ø±ÙŠ:
```bash
POST /api/attendance-engine/jobs/monthly
{"target_month": "2026-02", "finalize": true}
```

### Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙØ¹Ù„ÙŠ:
```
ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: 2026-02-17
ğŸ‘¥ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ÙŠÙ†: 7
âœ… Ù†Ø¬Ø­: 7
âŒ ÙØ´Ù„: 0
ğŸš« ØºÙŠØ§Ø¨: 4
âœ”ï¸ Ø­Ø¶ÙˆØ±: 0
ğŸ–ï¸ Ø¥Ø¬Ø§Ø²Ø©: 0
ğŸ“ Ù…Ù‚ØªØ±Ø­Ø§Øª Ø®ØµÙ…: 4
â±ï¸ Ø§Ù„Ù…Ø¯Ø©: 0.06 Ø«Ø§Ù†ÙŠØ©
```

---

## 6. Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª

### Test 1: ÙˆØ¬ÙˆØ¯ Ø¨ØµÙ…Ø© ÙŠÙ…Ù†Ø¹ Ø§Ù„ØºÙŠØ§Ø¨ âœ…
### Test 2: ÙˆØ¬ÙˆØ¯ Ø¥Ø¬Ø§Ø²Ø© Ù…Ù†ÙØ°Ø© ÙŠÙ…Ù†Ø¹ Ø§Ù„ØºÙŠØ§Ø¨ âœ…
### Test 3: Ù„Ø§ Ø®ØµÙ… Ø¨Ø¯ÙˆÙ† STAS âœ…
### Test 4: Ø§Ù„Ø¹Ø±ÙˆÙ‚ Ù…ÙƒØªÙ…Ù„Ø© (8/8 Ø®Ø·ÙˆØ§Øª) âœ…
### Test 5: Job Ø§Ù„ÙŠÙˆÙ…ÙŠ ÙŠØ¹Ù…Ù„ âœ…

---

## 7. Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©/Ø§Ù„Ù…Ø¶Ø§ÙØ©

| Ø§Ù„Ù…Ù„Ù | Ø§Ù„Ø­Ø§Ù„Ø© | Ø§Ù„ÙˆØµÙ |
|-------|--------|-------|
| `/app/backend/services/day_resolver_v2.py` | Ø¬Ø¯ÙŠØ¯ | Ù…Ø­Ø±Ùƒ Ø§Ù„Ù‚Ø±Ø§Ø± Ù…Ø¹ Ø§Ù„Ø¹Ø±ÙˆÙ‚ |
| `/app/backend/services/attendance_jobs.py` | Ø¬Ø¯ÙŠØ¯ | Jobs Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© |
| `/app/backend/services/warning_service.py` | Ø¬Ø¯ÙŠØ¯ | Ø§Ù„Ø¥Ù†Ø°Ø§Ø±Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª |
| `/app/backend/routes/attendance_engine.py` | Ù…Ø¹Ø¯Ù„ | APIs Ø¬Ø¯ÙŠØ¯Ø© |
| `/app/backend/routes/stas.py` | Ù…Ø¹Ø¯Ù„ | Deduction Mirror API |
| `/app/frontend/src/pages/MyFinancesPage.js` | Ø¬Ø¯ÙŠØ¯ | ØµÙØ­Ø© Ù…Ø§Ù„ÙŠÙ‘Ø§ØªÙŠ |

---

**Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ±**
